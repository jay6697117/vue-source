<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue数据双向绑定</title>
  </head>
  <body>
    <!-- <input oninput="handleChange(event)" />
    <p></p>
    <script>
      const data = { value: 'hello' };
      document.querySelector('p').innerText = data.value;
      const handleChange = e => {
        const val = e.target.value;
        console.log('val', val);
        data.value = val
        document.querySelector('p').innerText = data.value;
      };
    </script> -->

    <script>
      /**
       * 发布者
       */
      function Subject() {
        // 单个发布者的所有订阅者
        this.observers = [];
        // 添加一个订阅者
        this.attach = callback => {
          this.observers.push(callback);
        };

        // 通过所有的订阅者
        this.notify = value => {
          this.observers.forEach(callback => callback(value));
        };
      }

      /**
       * 订阅者
       */
      function Observer(queue, key, callback) {
        queue[key].attach(callback);
      }

      // 消息队列
      const messageQueue = {};
      // 数据
      const myData = { value1: '', value2: '' };

      // 将每个数据属性添加可订阅的入口
      for (const key in myData) {
        messageQueue[key] = new Subject();
      }
/*
      // 订阅 value 值的变化
      Observer(messageQueue, 'value', value => {
        console.warn('value updated:', value);
      });
 */
      // 将每个数据属性添加可订阅的入口
      for (const key in myData) {
        // 订阅 value 值的变化
        Observer(messageQueue, key, value => {
          console.warn('value updated:', value);
        });
      }

      console.log('messageQueue 1:', messageQueue);
      console.log('myData 1:', myData);

      /**
       * 手动更新数据
       */
      function setData(data, key, value) {
        data[key] = value;

        // 通知此值的所有订阅者，数据发生了更新
        messageQueue[key].notify(value);
      }

      // 更新数据
      setData(myData, 'value1', 'hello world.');
      setData(myData, 'value2', 100);
      setData(myData, 'value2', true);

      console.log('messageQueue 2:', messageQueue);
      console.log('myData 2:', myData);
    </script>
  </body>
</html>
